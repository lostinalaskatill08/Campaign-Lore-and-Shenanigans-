function QuestTracker() {
  const [quests, setQuests] = React.useState(() => {
    const saved = localStorage.getItem("quests");
    return saved ? JSON.parse(saved) : [];
  });
  const [formMode, setFormMode] = React.useState("none"); // 'none', 'add', or {id: questId}

  React.useEffect(() => {
    localStorage.setItem("quests", JSON.stringify(quests));
  }, [quests]);

  const addQuest = () => setFormMode("add");
  const editQuest = (id) => setFormMode({ id });
  const cancelForm = () => setFormMode("none");

  const handleFormSubmit = (formData) => {
    if (formMode === "add") {
      setQuests([...quests, { id: Date.now(), ...formData }]);
    } else if (formMode.id) {
      setQuests(quests.map((q) => (q.id === formMode.id ? { ...q, ...formData } : q)));
    }
    setFormMode("none");
  };

  const removeQuest = (id) => setQuests(quests.filter((q) => q.id !== id));

  return (
    <div className="mt-4">
      <h3 className="text-lg font-bold mb-2">Quest Tracker</h3>
      <p className="text-sm text-gray-700 mb-2">Manage your ongoing quests here.</p>
      <button
        className="px-3 py-1 bg-amber-700 text-white rounded hover:bg-amber-800 mb-2"
        onClick={addQuest}
      >
        Add New Quest
      </button>
      {formMode === "add" && <QuestForm onSubmit={handleFormSubmit} onCancel={cancelForm} />}
      <ul className="space-y-2">
        {quests.map((quest) => (
          <li key={quest.id} className="bg-white p-2 rounded shadow">
            <div className="flex justify-between items-center">
              <span>{quest.name} - {quest.status}</span>
              <div>
                <button
                  className="text-blue-500 hover:text-blue-700 mr-2"
                  onClick={() => editQuest(quest.id)}
                >
                  Edit
                </button>
                <button
                  className="text-red-500 hover:text-red-700"
                  onClick={() => removeQuest(quest.id)}
                >
                  Delete
                </button>
              </div>
            </div>
            {formMode.id === quest.id && (
              <QuestForm quest={quest} onSubmit={handleFormSubmit} onCancel={cancelForm} />
            )}
          </li>
        ))}
      </ul>
    </div>
  );
}

function QuestForm({ quest, onSubmit, onCancel }) {
  const [name, setName] = React.useState(quest ? quest.name : "");
  const [description, setDescription] = React.useState(quest ? quest.description : "");
  const [status, setStatus] = React.useState(quest ? quest.status : "active");

  const handleSubmit = (e) => {
    e.preventDefault();
    if (!name.trim()) {
      alert("Quest name is required");
      return;
    }
    onSubmit({ name, description, status });
  };

  return (
    <form onSubmit={handleSubmit} className="space-y-2 p-2 bg-gray-50 rounded">
      <div>
        <label className="block text-sm font-medium text-gray-700">Name</label>
        <input
          type="text"
          value={name}
          onChange={(e) => setName(e.target.value)}
          className="w-full border p-1 rounded"
          required
        />
      </div>
      <div>
        <label className="block text-sm font-medium text-gray-700">Description</label>
        <textarea
          value={description}
          onChange={(e) => setDescription(e.target.value)}
          className="w-full border p-1 rounded"
        />
      </div>
      <div>
        <label className="block text-sm font-medium text-gray-700">Status</label>
        <select
          value={status}
          onChange={(e) => setStatus(e.target.value)}
          className="w-full border p-1 rounded"
        >
          <option value="active">Active</option>
          <option value="completed">Completed</option>
          <option value="failed">Failed</option>
        </select>
      </div>
      <div className="flex gap-2">
        <button
          type="submit"
          className="px-3 py-1 bg-amber-700 text-white rounded hover:bg-amber-800"
        >
          Save
        </button>
        <button
          type="button"
          onClick={onCancel}
          className="px-3 py-1 bg-gray-300 text-gray-700 rounded hover:bg-gray-400"
        >
          Cancel
        </button>
      </div>
    </form>
  );
}
